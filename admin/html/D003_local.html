{% extends "local_mul.html" %}
{% block MUL_BTNS %}
{{BTNS}}
{% endblock %}


{% block mMul_Page_1 %}
<div class="panel-body">
    <div class="row" style="display:;">

        <div class="col-sm-12">
            <button class="btn btn-xs btn-info" type="button" onclick="layer_add()">
                <i class="fa fa-plus">增加拼团商品</i>
            </button>
            <table class="table table-bordered addRowtb" name="detail">
                <thead>
                <tr bgcolor="#ffffff">
                    <th style="text-align:center;width:80px;">拼团ID</th>
                    <th style="text-align:center;width:260px;">商品名称</th>
                    <th style="text-align:center;width:80px;">成团人数</th>
                    <th style="text-align:center;width:90px;">进行中</th>
                    <th style="text-align:center;width:80px;">开团人数</th>
                    <th style="text-align:center;width:100px;">超时时间</th>
                    <th style="text-align:center;width:150px;">开团类型</th>
                    <th style="text-align:center;width:150px;">参团类型</th>
                    <th style="text-align:center;width:150px;">退款方式</th>
                    <th style="text-align:center;width:100px;">开始时间</th>
                    <th style="text-align:center;width:100px;">到期时间</th>
                    <th style="text-align:center;width:150px;">状态</th>
                    <th style="text-align:center;width:150px;">操作</th>

                </tr>
                </thead>
                <tbody>

                {% for row in dataList %}
                <tr>
                    {% for e in row%}

                    <td>{{e}}</td>

                    {% endfor %}
                    <td style="text-align:center;">
                        {% if lR[1] == '' %}
                        <a class="btn btn-xs btn-info" onclick="ajax_update({{row[0]}})" title="编辑"><i
                                class="fa fa-edit"></i></a>
                        {% endif %}
                        {% if lR[2] == '' %}
                        <a class="btn btn-xs btn-warning" onclick="ajax_del({{row[0]}});" title="删除"><i
                                class="fa fa-trash-o"></i></a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                </tbody>

            </table>
            {{html_pager}}
        </div>
    </div>
    {{go_mselect}}
</div>
<script>
$(function(){

 });
 function oktype(obj){
    if (obj.value=='1'){
        $.ajax({
            url:sUrl+"&part=oktype&id="+obj.value,
            async:false,
            success: function(data){
                if (data.code!='0'){
                     layer.msg(data.MSG);
                     $('select[name=ok_type]').val(0);
                }
            }
        });
    }
}

function setdaytime(obj){return WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'});}

function ajax_del(del_pk){
		layer.confirm('你确信要删除记录吗？', {
			btn: ['是','否'] //按钮
		}, function(index,layero){
			layer.close(index);
			$.ajax({
				url:sUrl+"&part=ajax_del&pk="+del_pk,
				async:false,
				success: function(data){
					layer.msg(data.MSG);
					location.reload();
				}
			});

		}, function(){
			layer.closeAll();
		});

	}
    function ajax_update(id){
            var itemdata=''
			$.ajax({
				url:sUrl+"&part=ajax_update&pk="+id,
				async:false,
				success: function(res){
					if (res.code!='0'){
					    layer.msg('数据请求有误');
                        location.reload();
                    }else{
					    itemdata=res.data
					}
				}
			});
            if (itemdata!=''){
            content_html='<br><div class="col-sm-12">';
            content_html+='<label class="col-sm-1 control-label" style="width:61px;"><b style="color:#333333;">商品:</b></label>';
            content_html+='<div class="col-sm-10">';
            content_html+='<div class="col-sm-12"><div class="col-sm-8" style="width:180px;">'
            content_html+='<input type="hidden" name="goods_id" value="'+itemdata.goods_id+'"/>'
            content_html+='<input type="text" class="form-control"  name="good_name" value="'+itemdata.good_name+'" readonly="1"/>'
            content_html+='</div>'
            content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_loadUsersList(\'\')">选择商品</button>';
            //content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_clearPutOut()">清除</button>';
            content_html+='</div>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="pt_num" value="'+itemdata.pt_num+'"/>';
            content_html+='</div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">成团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="ok_num" value="'+itemdata.ok_num+'"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">超时时间(小时):</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="timeout_h" value="'+itemdata.timeout_h+'"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="kt_type" class="form-control">';
            if(1== itemdata.kt_type){
            content_html+='<option value="1" selected="selected">新人团</option>';
            content_html+='<option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            }else if (2== itemdata.kt_type){
            content_html+='<option value="1">新人团</option>';
            content_html+='<option value="2" selected="selected">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            }else{
            content_html+='<option value="1">新人团</option>';
            content_html+='<option value="2">老用户团</option>';
            content_html+='<option value="3" selected="selected">新老用户团</option></select></div></div>';
            }

            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">参团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="add_type" class="form-control">';
            if(1== itemdata.add_type){
            content_html+='<option value="1" selected="selected">新人团</option>';
            content_html+='<option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            }else if (2== itemdata.add_type){
            content_html+='<option value="1">新人团</option>';
            content_html+='<option value="2" selected="selected">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            }else{
            content_html+='<option value="1">新人团</option>';
            content_html+='<option value="2">老用户团</option>';
            content_html+='<option value="3" selected="selected">新老用户团</option></select></div></div>';
            }
            content_html+='<br><br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">退款方式:</b></label>';
            content_html+='<div class="col-sm-6"><select name="tk_type" class="form-control">';
            if (1== itemdata.tk_type){
            content_html+='<option value="1" selected="selected">原路退回</option>';
            content_html+='<option value="2">退回余额</option>';
            }else{
            content_html+='<option value="1">原路退回</option>';
            content_html+='<option value="2" selected="selected">退回余额</option>';
            }
            content_html+='</select><span style="color:red;">原路退回请注意上传证书</span></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期促团:</b></label>';
            content_html+='<div class="col-sm-6"><select name="ok_type" class="form-control">';
            if (1== itemdata.ok_type){
            content_html+='<option value="0">否</option>';
            content_html+='<option value="1" selected="selected">是</option>';
            }else{
            content_html+='<option value="0" selected="selected">否</option>';
            content_html+='<option value="1" >是</option>';
            }
            content_html+='</select><span style="color:red;">到期促团请进行促团设置</span></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">状态:</b></label>';
            content_html+='<div class="col-sm-6"><select name="status" class="form-control">';
            if (1== itemdata.status){
            content_html+='<option value="0">启用</option>';
            content_html+='<option value="1" selected="selected">禁用</option>';
            }else{
            content_html+='<option value="0" selected="selected">启用</option>';
            content_html+='<option value="1" >禁用</option>';
            }
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">推荐:</b></label>';
            content_html+='<div class="col-sm-6"><select name="recom" class="form-control">';
            if (1== itemdata.recom){
            content_html+='<option value="0">否</option>';
            content_html+='<option value="1" selected="selected">是</option>';
            }else{
            content_html+='<option value="0" selected="selected">否</option>';
            content_html+='<option value="1" >是</option>';
            }
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开始时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_add"  value="'+itemdata.date_add+'" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_end"  value="'+itemdata.date_end+'" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div>';

            layer.open({
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['40rem;', '48rem;'], //宽高
                content: content_html,
                title: "修改拼团商品",
                zIndex:999,
                btn: ['提交']
                ,yes: function(index, layero){
                   var goods_id = $('input[name=goods_id]').val();
                   var good_name = $('input[name=good_name]').val();

                   var pt_num = $('input[name=pt_num]').val();
                   var ok_num = $('input[name=ok_num]').val();
                   var timeout_h = $('input[name=timeout_h]').val();
                   var kt_type = $('select[name=kt_type]').val();
                   var add_type = $('select[name=add_type]').val();
                   var tk_type = $('select[name=tk_type]').val();
                   var ok_type = $('select[name=ok_type]').val();
                   var status = $('select[name=status]').val();
                   var recom = $('select[name=recom]').val();
                   var date_add = $('input[name=date_add]').val();
                   var date_end = $('input[name=date_end]').val();
				   if(goods_id=='' || good_name==''){
				   		layer.msg('请选择商品！')
				   		return false;
				   }

				   if(pt_num==''){
				   		layer.msg('请填写开团人数！')
				   		return false;
				   }
				   if(ok_num==''){
				   		layer.msg('请填写成团人数！')
				   		return false;
				   }
				   if(timeout_h==''){
				   		layer.msg('请填写超时时间！')
				   		return false;
				   }
				   if(date_add==''){
				   		layer.msg('请填写开始时间！')
				   		return false;
				   }
				   if(date_end==''){
				   		layer.msg('请填写到期时间！')
				   		return false;
				   }
                   formdata={'viewid':'D003','part':'insert','multab':'1','goods_id':goods_id,
                        'good_name':good_name,'pt_num':pt_num,'ok_num':ok_num,'recom':recom,
                        'timeout_h':timeout_h,'kt_type':kt_type,'add_type':add_type,'tk_type':tk_type,
                        'ok_type':ok_type,'status':status,'date_add':date_add,'date_end':date_end,'ptid':id
                   }
                   $.ajax({
                        url:"admin",
                        type:"post",
                        data:formdata,
                        async:false,
                        success: function(res){
                            layer.close(index);
                            layer.msg(res.MSG);
                            location.reload();
                        }
                   });
                 }
            });
            }
        }

       function layer_add(){

            content_html='<br><div class="col-sm-12">';
            content_html+='<label class="col-sm-1 control-label" style="width:61px;"><b style="color:#333333;">商品:</b></label>';
            content_html+='<div class="col-sm-10">';
            content_html+='<div class="col-sm-12"><div class="col-sm-8" style="width:180px;">'
            content_html+='<input type="hidden" name="goods_id" value=""/>'
            content_html+='<input type="text" class="form-control"  name="good_name" value="" readonly="1"/>'
            content_html+='</div>'
            content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_loadUsersList(\'\')">选择商品</button>';
            //content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_clearPutOut()">清除</button>';
            content_html+='</div>';
            content_html+='</div></div><br><br>';

            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="pt_num" value=""/>';
            content_html+='</div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">成团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="ok_num" value=""/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">超时时间(小时):</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="timeout_h" value=""/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="kt_type" class="form-control">';
            content_html+='<option value="1">新人团</option><option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">参团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="add_type" class="form-control">';
            content_html+='<option value="1">新人团</option><option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            content_html+='<br><br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">退款方式:</b></label>';
            content_html+='<div class="col-sm-6"><select name="tk_type" class="form-control">';
            content_html+='<option value="2">退回余额</option><option value="1">原路退回</option>';
            content_html+='</select><span style="color:red;">原路退回请注意上传证书</span></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期促团:</b></label>';
            content_html+='<div class="col-sm-6"><select name="ok_type" class="form-control" onchange="oktype(this)">';
            content_html+='<option value="0">否</option><option value="1">是</option>';
            content_html+='</select><span style="color:red;">到期促团请进行促团设置</span></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">状态:</b></label>';
            content_html+='<div class="col-sm-6"><select name="status" class="form-control">';
            content_html+='<option value="0">启用</option><option value="1">禁用</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">推荐:</b></label>';
            content_html+='<div class="col-sm-6"><select name="recom" class="form-control">';
            content_html+='<option value="0">否</option><option value="1">是</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开始时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_add"  value="" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_end"  value="" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div>';

            layer.open({
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['40rem;', '48rem;'], //宽高
                content: content_html,
                title: "增加拼团商品",
                zIndex:999,
                btn: ['提交']
                ,yes: function(index, layero){
                   var goods_id = $('input[name=goods_id]').val();
                   var good_name = $('input[name=good_name]').val();

                   var pt_num = $('input[name=pt_num]').val();
                   var ok_num = $('input[name=ok_num]').val();
                   var timeout_h = $('input[name=timeout_h]').val();
                   var kt_type = $('select[name=kt_type]').val();
                   var add_type = $('select[name=add_type]').val();
                   var tk_type = $('select[name=tk_type]').val();
                   var ok_type = $('select[name=ok_type]').val();
                   var status = $('select[name=status]').val();
                   var recom = $('select[name=recom]').val();
                   var date_add = $('input[name=date_add]').val();
                   var date_end = $('input[name=date_end]').val();
				   if(goods_id=='' || good_name==''){
				   		layer.msg('请选择商品！')
				   		return false;
				   }

				   if(pt_num==''){
				   		layer.msg('请填写开团人数！')
				   		return false;
				   }
				   if(ok_num==''){
				   		layer.msg('请填写成团人数！')
				   		return false;
				   }
				   if(timeout_h==''){
				   		layer.msg('请填写超时时间！')
				   		return false;
				   }
				   if(date_add==''){
				   		layer.msg('请填写开始时间！')
				   		return false;
				   }
				   if(date_end==''){
				   		layer.msg('请填写到期时间！')
				   		return false;
				   }
                   formdata={'viewid':'D003','part':'insert','multab':'1','goods_id':goods_id,
                        'good_name':good_name,'pt_num':pt_num,'ok_num':ok_num,'recom':recom,
                        'timeout_h':timeout_h,'kt_type':kt_type,'add_type':add_type,'tk_type':tk_type,
                        'ok_type':ok_type,'status':status,'date_add':date_add,'date_end':date_end,'ptid':0
                   }
                   $.ajax({
                        url:"admin",
                        type:"post",
                        data:formdata,
                        async:false,
                        success: function(res){
                            layer.close(index);
                            layer.msg(res.MSG);
                            location.reload();
                        }
                   });
                 }
            });
        }


</script>
{% endblock %}

{% block mMul_Page_2 %}
<div class="panel-body">
    <div class="row" style="display:;">

        <div class="col-sm-12">
            <table class="table table-bordered addRowtb" name="detail">
                <thead>
                <tr bgcolor="#ffffff">
                    <th style="text-align:center;width:80px;">团号</th>
                    <th style="text-align:center;width:80px;">拼团ID</th>
                    <th style="text-align:center;width:260px;">商品名称</th>
                    <th style="text-align:center;width:80px;">团长昵称</th>
                    <th style="text-align:center;width:90px;">团长手机</th>
                    <th style="text-align:center;width:80px;">参与人数</th>
                    <th style="text-align:center;width:150px;">开团类型</th>
                    <th style="text-align:center;width:150px;">参团类型</th>
                    <th style="text-align:center;width:100px;">状态</th>
                    <th style="text-align:center;width:100px;">开团时间</th>
                    <th style="text-align:center;width:100px;">到期时间</th>
                    <th style="text-align:center;width:150px;">操作</th>

                </tr>
                </thead>
                <tbody>

                {% for row in dataList %}
                <tr>
                    {% for e in row%}

                    <td>{{e}}</td>

                    {% endfor %}
                    <td style="text-align:center;">
                        {% if lR[1] == '' %}
                        <a class="btn btn-xs btn-info" onclick="set_ok({{row[0]}})" title="成团">设为成功</a>
                        {% endif %}
                        {% if lR[2] == '' %}
                        <a class="btn btn-xs btn-warning" onclick="set_fail({{row[0]}});" title="关团">设为失败</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                </tbody>

            </table>
            {{html_pager}}
        </div>
    </div>
    {{go_mselect}}
</div>
<script>
$(function(){

 });
function setdaytime(obj){return WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'});}

function set_ok(id){
		layer.confirm('你确定要设为成功吗？', {
			btn: ['是','否'] //按钮
		}, function(index,layero){
			layer.close(index);
			$.ajax({
				url:sUrl+"&part=go_ok&id="+id,
				async:false,
				success: function(data){
					layer.msg(data.MSG);
					if (data.code=='0'){
					    location.reload();
					}

				}
			});


		}, function(){
			layer.closeAll();
		});

	}

function set_fail(id){
		layer.confirm('你确定要设为失败吗？', {
			btn: ['是','否'] //按钮
		}, function(index,layero){
			layer.close(index);
			$.ajax({
				url:sUrl+"&part=go_fail&id="+id,
				async:false,
				success: function(data){
					layer.msg(data.MSG);
					if (data.code=='0'){
					    location.reload();
					}
				}
			});


		}, function(){
			layer.closeAll();
		});

	}
</script>
{% endblock %}

{% block mMul_Page_3 %}
<div class="panel-body">
    <div class="row" style="display:;">

        <div class="col-sm-12">
            <table class="table table-bordered addRowtb" name="detail">
                <thead>
                <tr bgcolor="#ffffff">
                    <th style="text-align:center;width:80px;">团号</th>
                    <th style="text-align:center;width:80px;">拼团ID</th>
                    <th style="text-align:center;width:260px;">商品名称</th>
                    <th style="text-align:center;width:80px;">订单ID</th>
                    <th style="text-align:center;width:80px;">团长昵称</th>
                    <th style="text-align:center;width:90px;">团长手机</th>
                    <th style="text-align:center;width:80px;">团员昵称</th>
                    <th style="text-align:center;width:100px;">团员手机</th>
                    <th style="text-align:center;width:150px;">下单时间</th>

                </tr>
                </thead>
                <tbody>

                {% for row in dataList %}
                <tr>
                    <td>{{row[0]}}</td>
                    <td>{{row[1]}}</td>
                    <td>{{row[2]}}</td>
                    <td>{{row[3]}}</td>
                    <td>{{row[4]}}</td>
                    <td>{{row[5]}}</td>

                    <td>{%for e in row[6]%}{{e.name}}<br>{%endfor%}</td>
                    <td>{%for e in row[6]%}{{e.phone}}<br>{%endfor%}</td>
                    <td>{{row[7]}}</td>



                    {#
                    <td style="text-align:center;">
                        {% if lR[1] == '' %}
                        <a class="btn btn-xs btn-info" onclick="ajax_update({{row[0]}})" title="编辑"><i
                                class="fa fa-edit"></i></a>
                        {% endif %}
                        {% if lR[2] == '' %}
                        <a class="btn btn-xs btn-warning" onclick="ajax_del({{row[0]}});" title="删除"><i
                                class="fa fa-trash-o"></i></a>
                        {% endif %}
                    </td>
                    #}
                </tr>
                {% endfor %}
                </tbody>

            </table>
            {{html_pager}}
        </div>
    </div>

</div>
<script>
$(function(){

 });
function setdaytime(obj){return WdatePicker({dateFmt:'yyyy-MM-dd HH:mm'});}

function ajax_del(del_pk){
		layer.confirm('你确信要删除记录吗？', {
			btn: ['是','否'] //按钮
		}, function(index,layero){
			layer.close(index);
			$.ajax({
				url:sUrl+"&part=ajax_del&pk="+del_pk,
				async:false,
				success: function(data){
					layer.msg(data.MSG);
					location.reload();
				}
			});

		}, function(){
			layer.closeAll();
		});

	}
    function ajax_update(id){
            var itemdata=''
			$.ajax({
				url:sUrl+"&part=ajax_update&pk="+id,
				async:false,
				success: function(res){
					if (res.code!='0'){
					    layer.msg('数据请求有误');
                        location.reload();
                    }else{
					    itemdata=res.data
					}
				}
			});
            if (itemdata!=''){
            content_html='<br><div class="col-sm-12">';
            content_html+='<label class="col-sm-1 control-label" style="width:61px;"><b style="color:#333333;">商品:</b></label>';
            content_html+='<div class="col-sm-10">';
            content_html+='<div class="col-sm-12"><div class="col-sm-8" style="width:180px;">'
            content_html+='<input type="hidden" name="goods_id" value="'+itemdata.goods_id+'"/>'
            content_html+='<input type="text" class="form-control"  name="good_name" value="'+itemdata.good_name+'" readonly="1"/>'
            content_html+='</div>'
            content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_loadUsersList(\'\')">选择商品</button>';
            //content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_clearPutOut()">清除</button>';
            content_html+='</div>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="pt_num" value="'+itemdata.pt_num+'"/>';
            content_html+='</div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">成团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="ok_num" value="'+itemdata.ok_num+'"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">超时时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="timeout_h" value="'+itemdata.timeout_h+'"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="kt_type" class="form-control">';
            content_html+='<option value="1">新人团</option><option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">参团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="add_type" class="form-control">';
            content_html+='<option value="1">新人团</option><option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            content_html+='<br><br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">退款方式:</b></label>';
            content_html+='<div class="col-sm-6"><select name="tk_type" class="form-control">';
            content_html+='<option value="1">原路退回</option><option value="2">退回余额</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期促团:</b></label>';
            content_html+='<div class="col-sm-6"><select name="ok_type" class="form-control">';
            content_html+='<option value="0">否</option><option value="1">是</option>';
            content_html+='</select></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">状态:</b></label>';
            content_html+='<div class="col-sm-6"><select name="status" class="form-control">';
            content_html+='<option value="0">启用</option><option value="1">禁用</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开始时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_add"  value="'+itemdata.date_add+'" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_end"  value="'+itemdata.date_end+'" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div>';

            layer.open({
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['40rem;', '48rem;'], //宽高
                content: content_html,
                title: "修改拼团商品",
                zIndex:999,
                btn: ['提交']
                ,yes: function(index, layero){
                   var goods_id = $('input[name=goods_id]').val();
                   var good_name = $('input[name=good_name]').val();
                   var pt_num = $('input[name=pt_num]').val();
                   var ok_num = $('input[name=ok_num]').val();
                   var timeout_h = $('input[name=timeout_h]').val();
                   var kt_type = $('select[name=kt_type]').val();
                   var add_type = $('select[name=add_type]').val();
                   var tk_type = $('select[name=tk_type]').val();
                   var ok_type = $('select[name=ok_type]').val();
                   var status = $('select[name=status]').val();
                   var date_add = $('input[name=date_add]').val();
                   var date_end = $('input[name=date_end]').val();
				   if(goods_id=='' || good_name==''){
				   		layer.msg('请选择商品！')
				   		return false;
				   }

				   if(pt_num==''){
				   		layer.msg('请填写开团人数！')
				   		return false;
				   }
				   if(ok_num==''){
				   		layer.msg('请填写成团人数！')
				   		return false;
				   }
				   if(timeout_h==''){
				   		layer.msg('请填写超时时间！')
				   		return false;
				   }
				   if(date_add==''){
				   		layer.msg('请填写开始时间！')
				   		return false;
				   }
				   if(date_end==''){
				   		layer.msg('请填写到期时间！')
				   		return false;
				   }
                   formdata={'viewid':'D003','part':'insert','multab':'1','goods_id':goods_id,
                        'good_name':good_name,'pt_price':pt_price,'pt_num':pt_num,'ok_num':ok_num,
                        'timeout_h':timeout_h,'kt_type':kt_type,'add_type':add_type,'tk_type':tk_type,
                        'ok_type':ok_type,'status':status,'date_add':date_add,'date_end':date_end,'ptid':id
                   }
                   $.ajax({
                        url:"admin",
                        type:"post",
                        data:formdata,
                        async:false,
                        success: function(res){
                            layer.close(index);
                            layer.msg(res.MSG);
                            location.reload();
                        }
                   });
                 }
            });
            }
        }

       function layer_add(){

            content_html='<br><div class="col-sm-12">';
            content_html+='<label class="col-sm-1 control-label" style="width:61px;"><b style="color:#333333;">商品:</b></label>';
            content_html+='<div class="col-sm-10">';
            content_html+='<div class="col-sm-12"><div class="col-sm-8" style="width:180px;">'
            content_html+='<input type="hidden" name="goods_id" value=""/>'
            content_html+='<input type="text" class="form-control"  name="good_name" value="" readonly="1"/>'
            content_html+='</div>'
            content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_loadUsersList(\'\')">选择商品</button>';
            //content_html+='&nbsp;<button class="btn btn-sm btn-info" type="button" onclick="Goods_clearPutOut()">清除</button>';
            content_html+='</div>';
            content_html+='</div></div><br><br>';

            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="pt_num" value=""/>';
            content_html+='</div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">成团人数:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="ok_num" value=""/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">超时时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="number" class="form-control"  name="timeout_h" value=""/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="kt_type" class="form-control">';
            content_html+='<option value="1">新人团</option><option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">参团类型:</b></label>';
            content_html+='<div class="col-sm-6"><select name="add_type" class="form-control">';
            content_html+='<option value="1">新人团</option><option value="2">老用户团</option>';
            content_html+='<option value="3">新老用户团</option></select></div></div>';
            content_html+='<br><br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">退款方式:</b></label>';
            content_html+='<div class="col-sm-6"><select name="tk_type" class="form-control">';
            content_html+='<option value="1">原路退回</option><option value="2">退回余额</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期促团:</b></label>';
            content_html+='<div class="col-sm-6"><select name="ok_type" class="form-control">';
            content_html+='<option value="0">否</option><option value="1">是</option>';
            content_html+='</select></div></div>';
            content_html+='<br><div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">状态:</b></label>';
            content_html+='<div class="col-sm-6"><select name="status" class="form-control">';
            content_html+='<option value="0">启用</option><option value="1">禁用</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">开始时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_add"  value="" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-3 control-label"><b style="color:#333333;">到期时间:</b></label>';
            content_html+='<div class="col-sm-6">';
            content_html+='<input type="text" class="form-control"  name="date_end"  value="" onclick="setdaytime(this)" readonly="1"/>';
            content_html+='</div></div>';

            layer.open({
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['40rem;', '48rem;'], //宽高
                content: content_html,
                title: "增加拼团商品",
                zIndex:999,
                btn: ['提交']
                ,yes: function(index, layero){
                   var goods_id = $('input[name=goods_id]').val();
                   var good_name = $('input[name=good_name]').val();

                   var pt_num = $('input[name=pt_num]').val();
                   var ok_num = $('input[name=ok_num]').val();
                   var timeout_h = $('input[name=timeout_h]').val();
                   var kt_type = $('select[name=kt_type]').val();
                   var add_type = $('select[name=add_type]').val();
                   var tk_type = $('select[name=tk_type]').val();
                   var ok_type = $('select[name=ok_type]').val();
                   var status = $('select[name=status]').val();
                   var date_add = $('input[name=date_add]').val();
                   var date_end = $('input[name=date_end]').val();
				   if(goods_id=='' || good_name==''){
				   		layer.msg('请选择商品！')
				   		return false;
				   }

				   if(pt_num==''){
				   		layer.msg('请填写开团人数！')
				   		return false;
				   }
				   if(ok_num==''){
				   		layer.msg('请填写成团人数！')
				   		return false;
				   }
				   if(timeout_h==''){
				   		layer.msg('请填写超时时间！')
				   		return false;
				   }
				   if(date_add==''){
				   		layer.msg('请填写开始时间！')
				   		return false;
				   }
				   if(date_end==''){
				   		layer.msg('请填写到期时间！')
				   		return false;
				   }
                   formdata={'viewid':'D003','part':'insert','multab':'1','goods_id':goods_id,
                        'good_name':good_name,'pt_price':pt_price,'pt_num':pt_num,'ok_num':ok_num,
                        'timeout_h':timeout_h,'kt_type':kt_type,'add_type':add_type,'tk_type':tk_type,
                        'ok_type':ok_type,'status':status,'date_add':date_add,'date_end':date_end,'ptid':0
                   }
                   $.ajax({
                        url:"admin",
                        type:"post",
                        data:formdata,
                        async:false,
                        success: function(res){
                            layer.close(index);
                            layer.msg(res.MSG);
                            location.reload();
                        }
                   });
                 }
            });
        }


</script>
{% endblock %}


{% block mMul_Page_4 %}
<h2>
<span style="color:red;">添加的用户越多，随机性越大，建议添加10个以上虚拟用户</span>
</h2>
<link href="static/web-uploader/css/uploader-image.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="static/web-uploader/js/Q.js"></script>
<script type="text/javascript" src="static/web-uploader/js/Q.Uploader.js"></script>
<script type="text/javascript" src="static/web-uploader/js/Q.Uploader.UI.Image.js"></script>
<div class="panel-body">
    <div class="row">
        <input type="hidden" name="sid" value=""/>
        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;">用户名字:</b></label>
            <div class="col-sm-3">
                <input type="text" class="form-control" name="cname" value=""/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;">用户头像:</b></label>
            <div class="col-sm-1">
                <input type="hidden" name="avatar" value=""/>
                <div class="row">
                    <div id="container" style="position: relative;">
                        <a id="pickfiles"  style="position: relative; z-index: 1;">[选择本地文件]</a>
                    </div>
                </div>
            </div>
            <div class="col-sm-2">
                <div id="logo">

                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;"></b></label>
            <div class="col-sm-3">
                <button class="btn btn-xs btn-info" type="button" onclick="ajax_add()">
                    <i class="fa fa-plus">提交</i>
                </button>
            </div>
        </div>

        <table class="table table-bordered addRowtb" name="detail">
            <thead>
            <tr bgcolor="#ffffff">

                <th style="text-align:center;width:260px;">用户名称</th>
                <th style="text-align:center;width:250px;">名像</th>
                <th style="text-align:center;width:80px;">修改</th>
            </tr>
            </thead>
            <tbody>

            {% for row in dataList %}
            <tr>
                {% for e in row[1:]%}
                    {%if loop.index==1%}
                    <td>{{e}}</td>
                    {%else%}
                    <td><img src="{{e}}" style="width:50px;"></td>
                    {%endif%}
                {% endfor %}
                <td style="text-align:center;">
                    <a class="btn btn-xs btn-info" onclick="ajax_edit({{row[0]}})" title="编辑"><i
                            class="fa fa-edit"></i></a>
                </td>
            </tr>
            {% endfor %}
            </tbody>

        </table>
        {{html_pager}}

    </div>


</div>


<script>

    function ajax_edit(id){

			$.ajax({
				url:sUrl+"&part=ajax_edit&id="+id,
				async:false,
				success: function(res){

					if (res.code!='0'){
					    layer.msg('数据请求有误');
                        location.reload();
                    }else{
					    $("#logo").html('');
                        var innerDivHtml = '<img src="'+ res.data.avatar  +'" class="col-sm-12">';
                        $("#logo").append(innerDivHtml);
                        $('input[name=avatar]').val(res.data.avatar);
                        $('input[name=cname]').val(res.data.cname);
                        $('input[name=sid]').val(res.data.id);
					}
				}
			});


        }

       function ajax_add(){
           var sid = $('input[name=sid]').val();
           var cname = $('input[name=cname]').val();
           var avatar = $('input[name=avatar]').val();

           if(cname==''){
                layer.msg('请填写用户名字！')
                return false;
           }
           if(avatar==''){
                layer.msg('请上传用户头像！')
                return false;
           }

           formdata={'viewid':'D003','part':'ajax_add','sid':sid,
                'cname':cname,'avatar':avatar
           }
           $.ajax({
                url:"admin",
                type:"post",
                data:formdata,
                async:false,
                success: function(res){
                    layer.msg(res.MSG);
                    location.reload();
                }
           });

        }
	var ids = new Array("pickfiles","pickfilesa");

    $.each(ids,function(i,n){
        var self = this.toString();
        //实例化一个plupload上传对象
        var Uploader = Q.Uploader,
        formatSize = Q.formatSize,
        boxView = document.getElementById("logo")
        var uploader = new Uploader({
            url: '/upload?viewid={{viewid}}&part=Img',
            target: document.getElementById(""+self+""),
            view: boxView,//如果去掉这个，会导致压缩效果不好
            //将auto配置为false以手动上传
            auto: true,
            dataType: "json",
            allows: ".jpg,.png,.gif,.bmp,.jpeg",
            upName: "file",
            //图片缩放
            /*scale: {
                //要缩放的图片格式
                types: ".jpg,.png,.jpeg,.bmp",
                //最大图片大小(width|height)
                maxWidth: 100
            },*/
            on: {
                //添加之前触发
                add: function (task) {
                	layer.load()
                    if (task.disabled) return layer.alert("允许上传的文件格式为：" + this.ops.allows);
                },
                upload: function (task) {
                	layer.load()
                },
                complete: function(task){
                    var jsons=task.json;
                    if(jsons){
                        $("#logo").html('');
                        var innerDivHtml = '<img src="'+ task.json.url  +'" class="col-sm-12">';
                        $("#logo").append(innerDivHtml);
                        $('input[name=avatar]').val(task.json.url);
                        layer.closeAll()
                    }else{
                        //layer.alert('上传图片故障！')
                        layer.closeAll()
                    }
                }
            }
        });
        uploader.start();//
    });

</script>

{% endblock %}


{#
{% block mMul_Page_5 %}
<div class="panel-body">
    <div class="row">

        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;">会员升级方式:</b></label>
            <input type="hidden" name="up_type_str" value="{{item.up_type_str or '付费升级'}}"/>
            <div class="col-sm-3">
                <select name="up_type" class="form-control" onchange="set_up_type(this)">
                    <option value="1" {{
                    ' selected="selected"' if item.up_type|string == '1'}}>付费升级</option>
                    <option value="2" {{
                    ' selected="selected"' if item.up_type|string == '2'}}>购物升级</option>
                </select>
            </div>
        </div>
        <div class="form-group" id="up_type_3">
            <label class="col-sm-2 control-label"><b style="color:#333333;">年费会员价格(元):</b></label>
            <div class="col-sm-3">
                <input type="number" class="form-control" name="vip_price" value="{{item.vip_price}}"/>
            </div>
        </div>
        <div class="form-group" id="up_type_1">
            <label class="col-sm-2 control-label"><b style="color:#333333;">会员折扣百分比(%):</b></label>
            <div class="col-sm-3">
                <input type="number" class="form-control" name="discount" value="{{item.discount}}"/>
            </div>
        </div>
    </div>

    <br>
    <div class="row" id="up_type_2" style="display:none;">

        <div class="col-sm-12">
            <div class="title_comm"><span class="block_blue"></span><b style="color:#333;">会员级别设置(名称空白的行不会保存)</b>
                <span style="float:right">
                    <button class="btn btn-xs btn-info" type="button" onclick="add_r('detail')" title="增加">
                        <i class="fa fa-plus"></i>
                    </button>
                    <button class="btn btn-xs btn-warning" type="button" onclick="del_r('detail')" title="删除">
                        <i class="fa fa-trash-o"></i>
                    </button>
                </span>
            </div>
            <table class="table table-bordered addRowtb" name="detail">
                <thead>
                <tr bgcolor="#ffffff">
                    <th style="text-align:center;width:60px;">序号</th>
                    <th style="text-align:center;width:260px;">级别名称</th>
                    <th style="text-align:center;width:250px;">升级价格(元)</th>
                    <th style="text-align:center;width:80px;">级别折扣(%)</th>
                </tr>
                </thead>
                <tbody>

                {% for e in detail %}
                <tr>
                    <td onclick='clickR(this);'>{{loop.index}}<input type='hidden' name='lid' value='{{e.id}}'/></td>
                    <td onclick='clickR(this);'><input type='text' name='cname' value='{{e.cname}}' class='form-control'
                                                       style='width:100%;'/></td>
                    <td onclick='clickR(this);'><input type='number' name='up_price' value='{{e.up_price}}'
                                                       class='form-control' style='width:100%;'/></td>
                    <td onclick='clickR(this);'><input type='number' name='level_discount' value='{{e.level_discount}}'
                                                       class='form-control number'
                                                       style='width:100%;ime-mode:Disabled;'/></td>
                </tr>
                {% endfor %}
                </tbody>

            </table>
        </div>
    </div>

</div>
<script>
$(function(){
    if($('select[name=up_type]').val()=='1'){
        $('#up_type_2').hide()
        $('#up_type_1').show()
        $('#up_type_3').show()
    }else{
        $('#up_type_2').show()
        $('#up_type_1').hide()
         $('#up_type_3').hide()
    }
 });
function set_up_type(obj){
    var hid=obj.value;
    layer.confirm('变更会员升级方式会带来不可逆的后果,您确信要变更吗？', {
			btn: ['是','否'] //按钮
		}, function(index,layero){
			 layer.close(index)
			 if (hid=='1'){
                    $('input[name=up_type_str]').val('付费升级');
                    $('#up_type_2').hide()
                    $('#up_type_1').show()
                    $('#up_type_3').show()
                }else{
                    $('input[name=up_type_str]').val('购物升级');
                    $('#up_type_2').show()
                    $('#up_type_1').hide()
                    $('#up_type_3').hide()
                }


		}, function(){
			if (hid=='1'){
                $('select[name=up_type]').val('2');
            }else{
               $('select[name=up_type]').val('1');
            }
		});
    /*layer.msg('变更会员升级方式会带来不可逆的后果')
    if (hid=='1'){
        $('input[name=up_type_str]').val('付费升级');
        $('#up_type_2').hide()
    }else{
        $('input[name=up_type_str]').val('购物升级');
        $('#up_type_2').show()
    }*/
    //console.log($('select[name=up_type]').val())
}

function add_r(tablename){

	var a= "show_option(this,'serlib','cgpm2')";
	var obj = $("[name="+tablename+"]");
	var tr = obj.find('tbody').find('tr');
	var rowNo = tr.length+1;
	html="<tr>"

	html+="<td onclick='clickR(this);'>"+rowNo+"<input type='hidden' name='lid' value='' /></td>";
	html+="<td onclick='clickR(this);'><input type='text' name='cname' value='' class='form-control' style='width:100%;'/></td>";
	html+="<td onclick='clickR(this);'><input type='text' name='up_price' value=''  class='form-control' style='width:100%;' /></td>";
	html+="<td onclick='clickR(this);'><input type='text' name='level_discount' value='' class='form-control number' /></td>";

	html+="</tr>";
	obj.append(html);
}

function del_r(tablename){
	var seltr=$("[name="+tablename+"]").find('tbody').find('tr.alert-warning');
	seltr.remove();
	if (tablename=='detail'){
		setSerialNo(tablename);
	}
}


function clickR(obj){
	var tr=$(obj).parent();
	tr.addClass('alert-warning');
	var trindex=$($(obj).parent()).index();
	var otr=$($($(obj).parent()).parent()).find('tr:not(:eq('+trindex+'))');
	for (i=0;i<otr.length;i++){
		$(otr[i]).removeClass('seltr');
	}
}

function setSerialNo(tablename){
	var seltr=$("[name="+tablename+"]").find('tbody').find('tr');
	for (i=0;i<seltr.length;i++){
		$(seltr[i]).find('td:first-child').html(i+1);
	}
}

</script>
{% endblock %}

{% block mMul_Page_6 %}
<link rel="stylesheet" type="text/css" href="static/asset/liger/ligerUI/skins/Aqua/css/ligerui-all.css">
<link rel="stylesheet" type="text/css" href="static/asset/liger/ligerUI/skins/Aqua/css/ligerui-layout.css">
<link rel="stylesheet" type="text/css" href="static/asset/liger/ligerUI/skins/Aqua/css/ligerui-grid.css">
<link rel="stylesheet" type="text/css" href="static/asset/liger/ligerUI/skins/Aqua/css/ligerui-common.css">
<script type="text/javascript" src="static/asset/liger/ligerUI/js/core/base.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerTree.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerGrid.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerResizable.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerDialog.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerMenu.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerSpinner.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerDrag.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerFilter.js"></script>
<script type="text/javascript" src="static/asset/liger/ligerUI/js/plugins/ligerToolBar.js"></script>
<script src="static/asset/liger/ligerUI/js/plugins/ligerComboBox.js" type="text/javascript"></script>
<div class="panel-body">
    <div class="row">
        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;">首页推荐商品设置:</b></label>
            <input type="hidden" name="home_goods_str" value="{{item.home_goods_str or '全部商品'}}"/>
            <div class="col-sm-3">
                <select name="home_goods" class="form-control" onchange="set_home_goods(this);">
                    <option value="0" {{
                    ' selected="selected"' if item.home_goods|string == '0'}}>全部商品</option>
                    <option value="1" {{
                    ' selected="selected"' if item.home_goods|string == '1'}}>指定商品</option>
                </select>
            </div>
            <div class="col-sm-6" id="home_page" style="display:none">
                <input type="text" class="form-control" name="goods_id" value="{{item.home_goods_id}}"
                       readonly="readonly"/>
                {{show_Goods}}
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;">购物车推荐商品设置:</b></label>
            <input type="hidden" name="shop_goods_str" value="{{item.shop_goods_str or '全部商品'}}"/>
            <div class="col-sm-3">
                <select name="shop_goods" class="form-control" onchange="set_shop_goods(this);">
                    <option value="0" {{
                    ' selected="selected"' if item.shop_goods|string == '0'}}>全部商品</option>
                    <option value="1" {{
                    ' selected="selected"' if item.shop_goods|string == '1'}}>指定商品</option>
                </select>
            </div>
            <div class="col-sm-6" id="shop_cart" style="display:none">
                <input type="text" class="form-control" name="goods_ids" value="{{item.shop_goods_id}}"
                       readonly="readonly"/>
                {{show_Goods_id}}
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label"><b style="color:#333333;">订单页推荐商品设置:</b></label>
            <input type="hidden" name="order_goods_str" value="{{item.order_goods_str or '全部商品'}}"/>
            <div class="col-sm-3">
                <select name="order_goods" class="form-control" onchange="set_order_goods(this);">
                    <option value="0" {{
                    ' selected="selected"' if item.order_goods|string == '0'}}>全部商品</option>
                    <option value="1" {{
                    ' selected="selected"' if item.order_goods|string == '1'}}>指定商品</option>
                </select>
            </div>
            <div class="col-sm-6" id="shop_order" style="display:none">
                <input type="text" class="form-control" name="order_goods_id" value="{{item.order_goods_id}}"
                       readonly="readonly"/>
                {{order_Goods_id}}
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label"><b style="color:#333333;">购物车页信息设置(多个用逗号隔开):</b></label>
            <div class="col-sm-8">
                <input type="text" name="shop_cart_memo" class="form-control" value="{{item.shop_cart_memo}}"/>
            </div>

        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label"><b style="color:#333333;">菜单页面搜索关键词设置(多个用逗号隔开):</b></label>
            <div class="col-sm-8">
                <input type="text" name="menu_memo" class="form-control" value="{{item.menu_memo}}"/>
            </div>

        </div>
    </div>
</div>
<script>

$(function(){

    if($('select[name=home_goods]').val()=='0'){
        $('#home_page').hide()
    }else{
        $('#home_page').show()
    }

    if($('select[name=shop_goods]').val()=='0'){
        $('#shop_cart').hide()
    }else{
        $('#shop_cart').show()
    }

    if($('select[name=order_goods]').val()=='0'){
        $('#shop_order').hide()
    }else{
        $('#shop_order').show()
    }
 });
function set_home_goods(obj){
    var hid=obj.value;
    if (hid=='1'){
        $('input[name=home_goods_str]').val('指定商品');
        $('#home_page').show()
        $('input[name=goods_id]').val('')
    }else{
        $('input[name=home_goods_str]').val('全部商品');
       $('#home_page').hide()
       $('input[name=goods_id]').val('0')
    }
}

function set_shop_goods(obj){
    var sid=obj.value;
    if (sid=='1'){
        $('input[name=shop_goods_str]').val('指定商品');
        $('#shop_cart').show()
        $('input[name=goods_ids]').val('')
    }else{
        $('input[name=shop_goods_str]').val('全部商品');
       $('#shop_cart').hide()
       $('input[name=goods_ids]').val('0')
    }
}

function set_order_goods(obj){
    var oid=obj.value;
    if (oid=='1'){
        $('input[name=order_goods_str]').val('指定商品');
        $('#shop_order').show()
        $('input[name=order_goods_id]').val('')
    }else{
        $('input[name=order_goods_str]').val('全部商品');
       $('#shop_order').hide()
       $('input[name=order_goods_id]').val('0')
    }
}


function add_r(tablename){

	var a= "show_option(this,'serlib','cgpm2')";
	var obj = $("[name="+tablename+"]");
	var tr = obj.find('tbody').find('tr');
	var rowNo = tr.length+1;
	html="<tr>"

	html+="<td onclick='clickR(this);'>"+rowNo+"<input type='hidden' name='lid' value='' /></td>";
	html+="<td onclick='clickR(this);'><input type='text' name='memo' value='' class='form-control' style='width:100%;'/></td>";
	//html+="<td onclick='clickR(this);'><input type='text' name='up_price' value=''  class='form-control' style='width:100%;' /></td>";
	//html+="<td onclick='clickR(this);'><input type='text' name='level_discount' value='' class='form-control number' /></td>";

	html+="</tr>";
	obj.append(html);
}

function del_r(tablename){
	var seltr=$("[name="+tablename+"]").find('tbody').find('tr.alert-warning');
	seltr.remove();
	if (tablename=='detail'){
		setSerialNo(tablename);
	}
}


function clickR(obj){
	var tr=$(obj).parent();
	tr.addClass('alert-warning');
	var trindex=$($(obj).parent()).index();
	var otr=$($($(obj).parent()).parent()).find('tr:not(:eq('+trindex+'))');
	for (i=0;i<otr.length;i++){
		$(otr[i]).removeClass('seltr');
	}
}

function setSerialNo(tablename){
	var seltr=$("[name="+tablename+"]").find('tbody').find('tr');
	for (i=0;i<seltr.length;i++){
		$(seltr[i]).find('td:first-child').html(i+1);
	}
}

</script>
{% endblock %}
#}


{% block page_script %}
<script type="text/javascript">
if({{save_alert}}==1){
	layer.alert('保存成功!',{yes:function(){
         window.location = 'admin?viewid={{viewid}}&part=localfrm&tab={{tab}}';
   }});
}else if ({{save_alert}}==2){
    layer.alert('保存失败!',{yes:function(){
         window.location = 'admin?viewid={{viewid}}&part=localfrm&tab={{tab}}';
   }});
}

</script>
<script>
    function formcheck_2(form){

        return true;

    }

</script>
{% endblock %}