{% extends "list.html" %}


{% block topSearch %}
<button type="button" class="btn btn-success btn-sm" onclick="layer_add()"><i class="fa fa-plus"></i> 增加品牌</button>
{% endblock %}

{% block mGrid %}
<link href="static/web-uploader/css/uploader-image.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="static/web-uploader/js/Q.js"></script>
<script type="text/javascript" src="static/web-uploader/js/Q.Uploader.js"></script>
<script type="text/javascript" src="static/web-uploader/js/Q.Uploader.UI.Image.js"></script>
<table class="table table-bordered">
    <thead>
        <tr style="background-color:#e5e5e5" bgcolor="#ffffff">

            {%for n in NL[1:]%}
            <th style="text-align:{{n[3]}};width:{{n[2]}};">{{n}}</th>
            {%endfor%}
            <th style="text-align:center">操作</th>
        </tr>
    </thead>

    <tbody>
        {% for row in dataList %}
        <tr bgcolor="#ffffff">

            {% for e in row%}
            {% if loop.index==4%}
            <td >
                {% if e %}
                <img src="{{e}}" style="width:50px;height:50px;"/>
                {% else %}
                -
                {% endif %}
            </td>
            {%else%}
            <td >{{e}}</td>
            {%endif%}
            {% endfor %}
            <td style="text-align:center;">
                {% if lR[1] == '' %}
                <a class="btn btn-xs btn-info" onclick="ajax_update({{row[0]}})" title="编辑"><i class="fa fa-edit"></i></a>
                {% endif %}
                {% if lR[2] == '' %}
                <a  class="btn btn-xs btn-warning" onclick="ajax_delete({{row[0]}});" title="删除"><i class="fa fa-trash-o"></i></a>
                {% endif %}

            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block page_script %}
<script>
    function ajax_update(id){
    		itemdata=''
			$.ajax({
				url:sUrl+"&part=ajax_update&pk="+id,
				async:false,
				success: function(data){
				    if(data.code='0'){
				        itemdata=data.data
				    }

				}
			});
			if (itemdata!=''){
				content_html='<form id="tf"><input type="hidden" name="id" value="'+id+'">';
                content_html+='<div class="col-sm-10">';
                content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">品牌排序:</b></label>';
                content_html+='<div class="col-sm-8"><select name="sort" class="form-control">';
                if(itemdata.sort=='A'){
                content_html+='<option value="A" selected="selected">A</option>';
                }else{
                content_html+='<option value="A">A</option>';
                }

                if(itemdata.sort=='B'){
                content_html+='<option value="B" selected="selected">B</option>';
                }else{
                content_html+='<option value="B">B</option>';
                }

                if(itemdata.sort=='C'){
                content_html+='<option value="C" selected="selected">C</option>';
                }else{
                content_html+='<option value="C">C</option>';
                }

                if(itemdata.sort=='D'){
                content_html+='<option value="D" selected="selected">D</option>';
                }else{
                content_html+='<option value="D">D</option>';
                }

                if(itemdata.sort=='E'){
                content_html+='<option value="E" selected="selected">E</option>';
                }else{
                content_html+='<option value="E">E</option>';
                }

                if(itemdata.sort=='F'){
                content_html+='<option value="F" selected="selected">F</option>';
                }else{
                content_html+='<option value="F">F</option>';
                }

                if(itemdata.sort=='G'){
                content_html+='<option value="G" selected="selected">G</option>';
                }else{
                content_html+='<option value="G">G</option>';
                }

                if(itemdata.sort=='H'){
                content_html+='<option value="H" selected="selected">H</option>';
                }else{
                content_html+='<option value="H">H</option>';
                }

                if(itemdata.sort=='I'){
                 content_html+='<option value="I" selected="selected">I</option>';
                }else{
                content_html+='<option value="I">I</option>';
                }

                if(itemdata.sort=='J'){
                content_html+='<option value="J" selected="selected">J</option>';
                }else{
                content_html+='<option value="J">J</option>';
                }

                if(itemdata.sort=='K'){
                content_html+='<option value="K" selected="selected">K</option>';
                }else{
                content_html+='<option value="K">K</option>';
                }

                if(itemdata.sort=='L'){
                content_html+='<option value="L" selected="selected">L</option>';
                }else{
                content_html+='<option value="L">L</option>';
                }

                if(itemdata.sort=='M'){
                content_html+='<option value="M" selected="selected">M</option>';
                }else{
                content_html+='<option value="M">M</option>';
                }

                if(itemdata.sort=='N'){
                content_html+='<option value="N" selected="selected">N</option>';
                }else{
                content_html+='<option value="N">N</option>';
                }

                if(itemdata.sort=='O'){
                content_html+='<option value="O" selected="selected">O</option>';
                }else{
                content_html+='<option value="O">O</option>';
                }

                if(itemdata.sort=='P'){
                content_html+='<option value="P" selected="selected">P</option>';
                }else{
                content_html+='<option value="P">P</option>';
                }

                if(itemdata.sort=='Q'){
                content_html+='<option value="Q" selected="selected">Q</option>';
                }else{
                content_html+='<option value="Q">Q</option>';
                }

                if(itemdata.sort=='R'){
                content_html+='<option value="R" selected="selected">R</option>';
                }else{
                content_html+='<option value="R">R</option>';
                }

                if(itemdata.sort=='S'){
                content_html+='<option value="S" selected="selected">S</option>';
                }else{
                content_html+='<option value="S">S</option>';
                }

                if(itemdata.sort=='T'){
                content_html+='<option value="T" selected="selected">T</option>';
                }else{
                content_html+='<option value="T">T</option>';
                }

                if(itemdata.sort=='U'){
                content_html+='<option value="U" selected="selected">U</option>';
                }else{
                content_html+='<option value="U">U</option>';
                }

                if(itemdata.sort=='V'){
                content_html+='<option value="V" selected="selected">V</option>';
                }else{
                content_html+='<option value="V">V</option>';
                }

                if(itemdata.sort=='W'){
                content_html+='<option value="W" selected="selected">W</option>';
                }else{
                content_html+='<option value="W">W</option>';
                }

                if(itemdata.sort=='X'){
                content_html+='<option value="X" selected="selected">X</option>';
                }else{
                content_html+='<option value="X">X</option>';
                }

                if(itemdata.sort=='Y'){
                content_html+='<option value="Y" selected="selected">Y</option>';
                }else{
                content_html+='<option value="Y">Y</option>';
                }

                if(itemdata.sort=='Z'){
                content_html+='<option value="Z" selected="selected">Z</option>';
                }else{
                content_html+='<option value="Z">Z</option>';
                }


                content_html+='</select></div></div><br><br>';
                content_html+='<div class="col-sm-10">';
                content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">品牌名称:</b></label>';
                content_html+=' <div class="col-sm-6">';
                content_html+=' <input type="text" class="form-control"  name="cname" value="'+itemdata.cname+'"/>';
                content_html+='</div></div><br><br>';
                content_html+='<div class="col-sm-10">';
                content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">品牌图标:</b></label>';
                content_html+=' <div class="col-sm-8">';
                content_html+=' <input type="file" accept="image/*" class="form-control" name="cicon" id="cicon" onchange="addFiles();"/>';
                content_html+='</div></div><br><br>';
                 content_html+='<div class="col-sm-10"><div class="col-sm-5" style="float:right;">';
                content_html+='<img src="'+itemdata.pic_icon+'" id="icon" class="col-sm-12" />';
                content_html+='<input type="hidden" name="url" value="'+itemdata.pic_icon+'"/>';
                content_html+='</div></div><br><br>';
                content_html+='<div class="col-sm-10">';
                content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">热门品牌:</b></label>';
                content_html+='<div class="col-sm-8"><select name="hot" class="form-control">';
                if(itemdata.hot==0){
                content_html+='<option value="0" selected="selected">否</option>';
                }else{
                content_html+='<option value="0">否</option>';
                }

                if(itemdata.hot==1){
                content_html+='<option value="1" selected="selected">是</option>';
                }else{
                content_html+='<option value="1">是</option>';
                }

                content_html+='</select></div></div><br><br>';
                content_html+='<div class="col-sm-10">';
                content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">状态:</b></label>';
                content_html+='<div class="col-sm-8"><select name="status" class="form-control">';
                if(itemdata.status==0){
                content_html+='<option value="0" selected="selected">显示</option>';
                }else{
                content_html+='<option value="0">显示</option>';
                }

                if(itemdata.status==1){
                content_html+='<option value="1" selected="selected">隐藏</option>';
                }else{
                content_html+='<option value="1">隐藏</option>';
                }

                content_html+='</select></div></div><br><br>';
                content_html+='<script>function addFiles(){var file = document.getElementById("cicon").files[0];';
                content_html+='var reader = new FileReader();reader.readAsDataURL(file);';
                content_html+='reader.onload=function(e){$("#icon").get(0).src = e.target.result;';
                content_html+='uploader.add(file);uploader.start();}}';
                content_html+='<\/script>';
                content_html+='</form>';

				layer.open({
					type: 1,
					skin: 'layui-layer-rim', //加上边框
					area: ['40rem;', '35rem;'], //宽高
					content: content_html,
					title: "修改商品品牌",
					btn: ['提交']
					,yes: function(index, layero){

						var cname = $('input[name=cname]').val();
						var url = $('input[name=url]').val();

						if(cname==''){
							layer.msg('请填写品牌名称！')
							return false;
						}
						if(url==''){
							layer.msg('请上传品牌图标！')
							return false;
						}


						var forms = new FormData(document.getElementById("tf"));
					   	$.ajax({
							url:"admin?viewid=C003&part=edit_brand",
							type:"post",
							data:forms,
							processData:false,
							contentType:false,
							success:function(data){
								if (data.code=='0'){
									layer.close(index);
									layer.msg(data.MSG);
									setTimeout(location.reload(), 3000);
								}else{
									layer.msg(data.MSG);
								}
							}
						});

					 }
				});
			}
        }

       function layer_add(){

			content_html='<form id="tf"><input type="hidden" name="id" value="">';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">品牌排序:</b></label>';
            content_html+='<div class="col-sm-8"><select name="sort" class="form-control">';
            content_html+='<option value="A">A</option>';
            content_html+='<option value="B">B</option>';
            content_html+='<option value="C">C</option>';
            content_html+='<option value="D">D</option>';
            content_html+='<option value="E">E</option>';
            content_html+='<option value="E">F</option>';
            content_html+='<option value="G">G</option>';
            content_html+='<option value="H">H</option>';
            content_html+='<option value="I">I</option>';
            content_html+='<option value="J">J</option>';
            content_html+='<option value="K">K</option>';
            content_html+='<option value="L">L</option>';
            content_html+='<option value="M">M</option>';
            content_html+='<option value="N">N</option>';
            content_html+='<option value="O">O</option>';
            content_html+='<option value="P">P</option>';
            content_html+='<option value="Q">Q</option>';
            content_html+='<option value="R">R</option>';
            content_html+='<option value="S">S</option>';
            content_html+='<option value="T">T</option>';
            content_html+='<option value="U">U</option>';
            content_html+='<option value="V">V</option>';
            content_html+='<option value="W">W</option>';
            content_html+='<option value="X">X</option>';
            content_html+='<option value="Y">Y</option>';
            content_html+='<option value="Z">Z</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">品牌名称:</b></label>';
            content_html+=' <div class="col-sm-6">';
            content_html+=' <input type="text" class="form-control"  name="cname" value=""/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">品牌图标:</b></label>';
            content_html+=' <div class="col-sm-8">';
            content_html+=' <input type="file" accept="image/*" class="form-control" name="cicon" id="cicon" onchange="addFiles();"/>';
            content_html+='</div></div><br><br>';
             content_html+='<div class="col-sm-10"><div class="col-sm-5" style="float:right;">';
            content_html+='<img src="" id="icon" class="col-sm-12" />';
            content_html+='<input type="hidden" name="url" value=""/>';
            content_html+='</div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">热门品牌:</b></label>';
            content_html+='<div class="col-sm-8"><select name="hot" class="form-control">';
            content_html+='<option value="0">否</option>';
            content_html+='<option value="1">是</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<div class="col-sm-10">';
            content_html+='<label class="col-sm-4 control-label"><b style="color:#333333;">状态:</b></label>';
            content_html+='<div class="col-sm-8"><select name="status" class="form-control">';
            content_html+='<option value="0">显示</option>';
            content_html+='<option value="1">隐藏</option>';
            content_html+='</select></div></div><br><br>';
            content_html+='<script>function addFiles(){var file = document.getElementById("cicon").files[0];';
            content_html+='var reader = new FileReader();reader.readAsDataURL(file);';
            content_html+='reader.onload=function(e){$("#icon").get(0).src = e.target.result;';
            content_html+='uploader.add(file);uploader.start();}}';
            content_html+='<\/script>';
            content_html+='</form>';

            layer.open({
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['40rem;', '35rem;'], //宽高
                content: content_html,
                title: "增加商品品牌",
                btn: ['提交']
                ,yes: function(index, layero){
                	var cname = $('input[name=cname]').val();
                    var url = $('input[name=url]').val();

                    if(cname==''){
                        layer.msg('请填写品牌名称！')
                        return false;
                    }
                    if(url==''){
                        layer.msg('请上传品牌图标！')
                        return false;
                    }


				   var forms = new FormData(document.getElementById("tf"));
				   $.ajax({
				   		url:"admin?viewid=C003&part=save_brand",
                        type:"post",
                        data:forms,
                        processData:false,
                        contentType:false,
                        success:function(data){
                            if (data.code=='0'){
                                layer.close(index);
                                layer.msg(data.MSG);
                                setTimeout(location.reload(), 3000);
                            }else{
                                layer.msg(data.MSG);
                            }
                        }
                    });

                 }
            });

        }



var Uploader = Q.Uploader,
    formatSize = Q.formatSize,
    boxView = document.getElementById("nox");
    var uploader = new Uploader({
    url: '/upload?viewid={{viewid}}&part=Img',
    target:document.getElementById("upload-s"),
    view: boxView,//如果去掉这个，会导致压缩效果不好
    //将auto配置为false以手动上传
    auto: false,
    dataType: "json",
    allows: ".jpg,.png,.bmp,.jpeg",
    upName: "file",
    //图片缩放
    /*scale: {
        //要缩放的图片格式
        types: ".jpg,.png,.jpeg,.bmp",
        //最大图片大小(width|height)
        maxWidth: 100
    },*/
    on: {
        //添加之前触发
        add: function (task) {
            if (task.disabled) return layer.alert("允许上传的文件格式为：" + this.ops.allows);
        },
        upload: function (task) {

        },
        complete: function(task){
            var jsons=task.json;
            if(jsons){
                if (jsons.url!=''){
                    $('input[name=url]').val(jsons.url)

                }
            }else{
                layer.msg('上传图片故障！')

            }
        }
        }
    });
</script>
{% endblock %}
